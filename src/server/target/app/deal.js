define(["deck","promise"],function(t){function e(){this.players=[],this.dealer={},this.deck=(new t).shuffle()}return e.prototype={BLACK_JACK:21,DEALER_THRESHOLD:17,startRound:function(){for(var t=this,e=1;2>=e;e++){this.players.forEach(function(e){e.hit(t.next())});var n=this.getDealer();n.hit(t.next())}},setPlayers:function(t){this.players=t},addPlayer:function(t){this.players.push(t)},getPlayer:function(t){return this.getPlayerByNick(t)},getPlayerByNick:function(t){var e;return this.players.forEach(function(n){n.getNick()===t&&(e=n)}),e},setDealer:function(t){this.dealer=t},getDealer:function(){return this.dealer},getPlayers:function(){return this.players},dealCards:function(){this.players.forEach(function(t){t.hand().push(next())})},next:function(){return this.deck.shift()}},e});